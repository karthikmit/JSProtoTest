<!DOCTYPE html>
<html>
<head>
    <title>Mini Twitter Feed App</title>
    <link rel="stylesheet" type="text/css" href="MiniTweeter.css">
</head>

<!-- Letz have Ajax to make JSON calls -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js" type="text/javascript"></script>

<script>

    followTweeter = function() {
        var twitterId = '<li>TWITTER_ID</li>';
        var checkboxString = "<input type='checkbox' id='TWITTERNAME' value='TWITTERNAME' checked='true' onclick='updateFeeds(displayFeeds)'>";
        var value = $('#twitterid').val();
        checkboxString = checkboxString.replace('TWITTERNAME',value) + value + "</input>";

        // Check whether the ID is already present or not.
        if(document.getElementById(value) === null) {
            $('#tweeterids').append(
                twitterId.replace('TWITTER_ID', checkboxString)
            )
            updateFeeds(displayFeeds);
        }
    }

    updateFeeds = function(onSuccessCallback) {
        FeedsQueue.feeds.length = 0;
        $('li').each(function(index, value) {
            var twitId = $(value).text();
            if(document.getElementById(twitId).checked) {
                FeedsQueue.getTweets(twitId, onSuccessCallback);
            }
            else
            {
                FeedsQueue.removeTweets(twitId, onSuccessCallback);
            }
        });
    }

    displayTweets = function(divisionId) {
        var html = '<div class="tweet">TWEET_TEXT<div class="time">AGO</div> <br>';

        for(var index = 0; index < FeedsQueue.feeds.length; index++)
        {
            var userfeeds = FeedsQueue.feeds[index];
            for(var i = 0; i < userfeeds.value.length; i++) {
                var feed = userfeeds.value[i];

                $('#recenttweets').append(
                        html.replace('TWEET_TEXT', feed.text)
                                .replace(/USER/g, feed.user.screen_name)
                                .replace('AGO', feed.created_at)
                                .replace(/ID/g, feed.id_str)
                );
            }
        }
    }

    displayFeeds = function(){
        $('#recenttweets').empty();
        displayTweets('#recentTweets');
    }
</script>

<script src="TwitterFeed.js">

</script>

<body>

    <div class="wrapper">
        <div id="userdetails">
            <h2> Latest Tweets Feeder </h2>

            <div id="username">
                Twitter ID: <input type="text" id="twitterid">
                <input type="submit" value="Follow Tweets" onclick="followTweeter()">
                <!--<input type="submit" onclick="updateFeeds()">-->
                <br>
            </div>
        </div>


        <div class="left">
            <h3> Tweets followed: </h3>
            <div>
                <ul id="tweeterids">

                </ul>
            </div>
        </div>
        <div class="right">
            <h3>Recent Tweets</h3>
            <div id="recenttweets">

            </div>
        </div>
    </div>

</body>
</html>